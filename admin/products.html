<!DOCTYPE html>
<html>
<head>
  <title>Product Management | Yug Enterprise</title>
  <style>
    body{margin:0;font-family:Arial;background:#f4f6f8}
    .header{background:#1f2937;color:white;padding:15px 30px;
      display:flex;justify-content:space-between}
    .layout{display:flex}
    .sidebar{width:220px;background:#111827;color:white;height:100vh}
    .sidebar a{display:block;padding:14px 20px;color:#d1d5db;text-decoration:none}
    .sidebar a:hover{background:#1f2937;color:white}
    .content{flex:1;padding:30px}
    input,textarea{width:100%;padding:8px;margin-bottom:10px}
    button{padding:8px 12px;border:none;background:#3b82f6;color:white;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:20px;background:white}
    th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
    img{width:60px}
  </style>
</head>
<body>

<div class="header">
  <h2>Product Management</h2>
  <button onclick="logout()">Logout</button>
</div>

<div class="layout">
  <div class="sidebar">
    <a href="dashboard.html">ðŸ“Š Dashboard</a>
    <a href="inquiries.html">ðŸ“© Inquiries</a>
    <a href="products.html">ðŸ“¦ Products</a>
  </div>

  <div class="content">
    <h3>Add New Product</h3>

    <input type="text" id="name" placeholder="Product Name">
    <input type="text" id="category" placeholder="Category">
    <textarea id="description" placeholder="Description"></textarea>

    <!-- FILE CHOOSE OPTION -->
    <input type="file" id="image">

    <button onclick="addProduct()">Add Product</button>

    <h3>All Products</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script>
const token = localStorage.getItem("token");
if(!token) location.href="login.html";

/* LOAD PRODUCTS */
function loadProducts(){
  fetch("http://localhost:5000/api/products")
  .then(res=>res.json())
  .then(data=>{
    const rows=document.getElementById("rows");
    rows.innerHTML="";
    data.forEach(p=>{
      rows.innerHTML+=`
        <tr>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td><img src="http://localhost:5000/uploads/${p.image}" 
     style="width:25%; height:10; object-fit:cover;">
          <td>
            <button onclick="del('${p._id}')">Delete</button>
          </td>
        </tr>
      `;
    });
  });
}

/* ADD PRODUCT */
function addProduct(){

  const formData = new FormData();
  formData.append("name", document.getElementById("name").value);
  formData.append("category", document.getElementById("category").value);
  formData.append("description", document.getElementById("description").value);
  formData.append("image", document.getElementById("image").files[0]);

  fetch("http://localhost:5000/api/products",{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+token
    },
    body:formData
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.success){
      alert("Product Added Successfully");
      loadProducts();
    } else {
      alert("Upload Failed");
    }
  })
  .catch(err=>{
    alert("Server Error");
    console.log(err);
  });
}

/* DELETE PRODUCT */
function del(id){
  fetch(`http://localhost:5000/api/products/${id}`,{
    method:"DELETE",
    headers:{
      "Authorization":"Bearer "+token
    }
  })
  .then(()=>loadProducts());
}

function logout(){
  localStorage.removeItem("token");
  location.href="login.html";
}

loadProducts();
</script>

</body>
</html>