<!DOCTYPE html>
<html>
<head>
  <title>Product Management | Yug Enterprise</title>
  <style>
    body{margin:0;font-family:Arial;background:#f4f6f8}
    .header{background:#1f2937;color:white;padding:15px 30px;
      display:flex;justify-content:space-between}
    .layout{display:flex}
    .sidebar{width:220px;background:#111827;color:white;height:100vh}
    .sidebar a{display:block;padding:14px 20px;color:#d1d5db;text-decoration:none}
    .sidebar a:hover{background:#1f2937;color:white}
    .content{flex:1;padding:30px}
    input,textarea,select{
      width:100%;
      padding:8px;
      margin-bottom:10px;
    }
    button{
      padding:8px 12px;
      border:none;
      background:#3b82f6;
      color:white;
      cursor:pointer;
      border-radius:4px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      background:white
    }
    th,td{
      padding:10px;
      border-bottom:1px solid #eee;
      text-align:left
    }
    img{
      width:70px;
      height:70px;
      object-fit:cover;
      border-radius:6px;
    }
    .deleteBtn{
      background:#ef4444;
    }
  </style>
</head>
<body>

<div class="header">
  <h2>Product Management</h2>
  <button onclick="logout()">Logout</button>
</div>

<div class="layout">
  <div class="sidebar">
    <a href="dashboard.html">ðŸ“Š Dashboard</a>
    <a href="inquiries.html">ðŸ“© Inquiries</a>
    <a href="products.html">ðŸ“¦ Products</a>
  </div>

  <div class="content">
    <h3>Add New Product</h3>

    <input type="text" id="name" placeholder="Product Name" required>

    <!-- CATEGORY DROPDOWN -->
    <select id="category" required>
      <option value="">Select Category</option>
      <option value="Safety Products">Safety Products</option>
      <option value="Power Tools">Power Tools</option>
      <option value="Tools & Tackles">Tools & Tackles</option>
      <option value="Fire Safety">Fire Safety</option>
      <option value="Cutting & Welding">Cutting & Welding</option>
    </select>

    <textarea id="description" placeholder="Description"></textarea>

    <input type="file" id="image" accept="image/*">

    <button onclick="addProduct()">Add Product</button>

    <h3>All Products</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script>

const API_BASE = "https://yug-enterprise-website.onrender.com";
const token = localStorage.getItem("token");

if(!token) location.href="login.html";

/* LOAD PRODUCTS */
function loadProducts(){
  fetch(`${API_BASE}/api/products`)
  .then(res=>res.json())
  .then(data=>{
    const rows=document.getElementById("rows");
    rows.innerHTML="";
    data.forEach(p=>{
      rows.innerHTML+=`
        <tr>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>
            <img src="${API_BASE}/uploads/${p.image}">
          </td>
          <td>
            <button class="deleteBtn" onclick="del('${p._id}')">Delete</button>
          </td>
        </tr>
      `;
    });
  });
}

/* ADD PRODUCT */
function addProduct(){

  const name = document.getElementById("name").value;
  const category = document.getElementById("category").value;
  const imageFile = document.getElementById("image").files[0];

  if(!name || !category || !imageFile){
    alert("Please fill all required fields");
    return;
  }

  const formData = new FormData();
  formData.append("name", name);
  formData.append("category", category);
  formData.append("description", document.getElementById("description").value);
  formData.append("image", imageFile);

  fetch(`${API_BASE}/api/products`,{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+token
    },
    body:formData
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.success){
      alert("Product Added Successfully");
      document.getElementById("name").value="";
      document.getElementById("category").value="";
      document.getElementById("description").value="";
      document.getElementById("image").value="";
      loadProducts();
    } else {
      alert("Upload Failed");
    }
  })
  .catch(err=>{
    alert("Server Error");
    console.log(err);
  });
}

/* DELETE PRODUCT */
function del(id){
  if(confirm("Delete this product?")){
    fetch(`${API_BASE}/api/products/${id}`,{
      method:"DELETE",
      headers:{
        "Authorization":"Bearer "+token
      }
    })
    .then(()=>loadProducts());
  }
}

function logout(){
  localStorage.removeItem("token");
  location.href="login.html";
}

loadProducts();

</script>

</body>
</html>